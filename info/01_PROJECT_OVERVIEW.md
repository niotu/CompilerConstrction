# O Language Compiler - Обзор Проекта

## Описание проекта

**O Language Compiler** — это полнофункциональный компилятор для объектно-ориентированного языка программирования O, написанный на C# (.NET 9.0). Компилятор транслирует исходный код на языке O в исполняемые сборки .NET (формат PE/COFF DLL), используя механизмы динамической генерации кода через System.Reflection.Emit.

## Основные характеристики

### Язык O

O — это объектно-ориентированный язык программирования с поддержкой:
- **Классов и наследования** (single inheritance)
- **Полей и методов** класса
- **Конструкторов** для инициализации объектов
- **Перегрузки методов** (method overloading)
- **Встроенных типов**: Integer, Real, Boolean, Array, List
- **Условных операторов**: if-then-else
- **Циклов**: while
- **Присваивания и возврата значений**

### Архитектура компилятора

Компилятор реализует классическую многофазную архитектуру:

```
┌─────────────────────┐
│  Исходный код (.o)  │
└──────────┬──────────┘
           ↓
    ┌──────────────┐
    │   ЛЕКСЕР     │  ← OLexer.cs
    │  (Tokenizer) │
    └──────┬───────┘
           ↓
    ┌──────────────┐
    │   ПАРСЕР     │  ← Grammar.y → OParser.cs
    │  (LALR(1))   │
    └──────┬───────┘
           ↓
    ┌──────────────┐
    │     AST      │  ← AstNodes.cs
    │ (Синтаксическое│
    │    дерево)    │
    └──────┬───────┘
           ↓
    ┌──────────────┐
    │ СЕМАНТИЧЕСКИЙ│  ← Checks.cs, Hierarchy.cs
    │    АНАЛИЗ    │
    └──────┬───────┘
           ↓
    ┌──────────────┐
    │ ОПТИМИЗАЦИИ  │  ← Optimizations.cs
    │     AST      │
    └──────┬───────┘
           ↓
    ┌──────────────┐
    │  ГЕНЕРАЦИЯ   │  ← CodeGenerator.cs
    │   IL КОДА    │     MethodGenerator.cs
    └──────┬───────┘
           ↓
    ┌──────────────┐
    │ .NET Assembly│  ← .dll файл
    │   (PE/COFF)  │
    └──────────────┘
```

## Ключевые компоненты

### 1. Лексический анализатор (Lexer)
- **Файл**: `src/OCompiler/Lexer/OLexer.cs`
- **Функция**: Преобразует исходный текст в последовательность токенов
- **Поддержка**: Ключевые слова, идентификаторы, литералы (Integer, Real, Boolean), операторы, комментарии

### 2. Синтаксический анализатор (Parser)
- **Файлы**: `src/OCompiler/Parser/Grammar.y`, `OParser.cs`
- **Генератор**: GPPG (Gardens Point Parser Generator) - LALR(1)
- **Функция**: Строит абстрактное синтаксическое дерево (AST) из токенов
- **Грамматика**: Описана в Grammar.y

### 3. Семантический анализатор
- **Файлы**: `src/OCompiler/Semantic/Checks.cs`, `Hierarchy.cs`, `SymbolTable.cs`
- **Функции**:
  - Проверка типов
  - Разрешение символов (идентификаторов)
  - Валидация наследования
  - Проверка корректности вызовов методов
  - Обнаружение дублирования объявлений

### 4. Генератор кода
- **Файлы**: `src/OCompiler/CodeGeneration/CodeGenerator.cs`, `MethodGenerator.cs`, `TypeMapper.cs`
- **Технология**: System.Reflection.Emit (динамическая генерация IL-кода)
- **Функции**:
  - Создание TypeBuilder для каждого класса
  - Генерация полей, конструкторов, методов
  - Маппинг типов O → .NET типы
  - Сохранение сборки в .dll файл

### 5. Runtime интерпретатор (опциональный)
- **Файл**: `src/OCompiler/Runtime/Interpreter.cs`
- **Функция**: Резервный механизм выполнения конструкторов в памяти
- **Применение**: Когда прямой вызов через Reflection недоступен

## Технологический стек

| Технология | Версия | Применение |
|------------|--------|------------|
| **.NET SDK** | 9.0 | Платформа разработки и выполнения |
| **C#** | 12.0 (latest) | Язык реализации компилятора |
| **System.Reflection.Emit** | 4.7.0+ | Динамическая генерация IL-кода |
| **System.Reflection.Metadata** | 8.0.0 | Работа с метаданными PE-файлов |
| **GPPG** (Gardens Point Parser Generator) | 1.5.3.1 | Генерация LALR(1) парсера из грамматики |
| **Mono.Cecil** | 0.11.4 | Постобработка PE-файлов для установки EntryPoint |
| **PersistedAssemblyBuilder** | .NET 9+ | Сохранение динамических сборок в файл |

## Поддерживаемые платформы

- **ОС**: Windows, Linux, macOS
- **Архитектура**: x64, ARM64
- **Runtime**: .NET 9.0

## Основные возможности

### Компиляция
```bash
dotnet run --project src/OCompiler -- program.o --emit-dll output
```

### Генерация исполняемого файла
```bash
dotnet run --project src/OCompiler -- program.o --emit-dll app
dotnet build/app.dll  # Запуск
```

### Отладочные режимы
```bash
# Показать токены
dotnet run --project src/OCompiler -- program.o --tokens-only

# Показать AST
dotnet run --project src/OCompiler -- program.o --ast

# Показать сгенерированный IL
dotnet run --project src/OCompiler -- program.o --emit-il

# Отладочный режим с детальной информацией
dotnet run --project src/OCompiler -- program.o --debug
```

## Статистика проекта

### Размер кодовой базы
- **Всего строк кода**: ~15,000 LOC
- **Файлов исходного кода**: 25+
- **Тестовых программ**: 30

### Результаты тестирования
- **Валидных тестов**: 20 (корректные программы)
- **Невалидных тестов**: 10 (ошибки компиляции)
- **Pass Rate**: ~89-93% (в зависимости от конфигурации)

### Производительность
- **Типичная компиляция**: 200-300ms
  - Лексинг: <10ms
  - Парсинг: <20ms
  - Семантика: 50-100ms
  - Генерация кода: 100-150ms
- **Размер сборки**: 2-5 KB IL-кода для типичной программы

## Особенности реализации

### Преимущества
1. **Полная интеграция с .NET**: Сгенерированные сборки совместимы с .NET ecosystem
2. **Динамическая генерация кода**: Использование Reflection.Emit для прямой генерации IL
3. **Многофазная архитектура**: Четкое разделение стадий компиляции
4. **Extensibility**: Легко добавлять новые встроенные типы и операции

### Ограничения
1. Нет поддержки generic типов (обобщенных классов)
2. Рекурсивные вызовы методов не поддерживаются
3. Виртуальные методы и полиморфизм частично реализованы
4. Статические члены классов не поддерживаются
5. Интерфейсы и абстрактные классы не реализованы

## Команда разработки

**Авторы**:
- Dmitriy Lukiyanov (SD-03)
- Ramil Aminov (SD-01)

**Учебное заведение**: Innopolis University  
**Курс**: Compiler Construction  
**Год**: 2025

---

*Документация создана: 30 ноября 2025 г.*
